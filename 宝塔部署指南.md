# ğŸš€ å®å¡”éƒ¨ç½²å®Œæ•´æŒ‡å—

## ğŸ“š æ–‡æ¡£è¯´æ˜

æœ¬é¡¹ç›®æä¾›å®Œæ•´çš„å®å¡”é¢æ¿éƒ¨ç½²æ–¹æ¡ˆï¼ŒåŒ…å«ä»¥ä¸‹æ–‡æ¡£ï¼š

1. **DEPLOY_BAOTA.md** - è¯¦ç»†éƒ¨ç½²æ­¥éª¤ï¼ˆæ¨èé˜…è¯»ï¼‰
2. **BAOTA_CHECKLIST.md** - éƒ¨ç½²æ£€æŸ¥æ¸…å•
3. **æœ¬æ–‡æ¡£** - å¿«é€Ÿå¼€å§‹æŒ‡å—

---

## âš¡ å¿«é€Ÿå¼€å§‹ï¼ˆ3 æ­¥éƒ¨ç½²ï¼‰

### ç¬¬ä¸€æ­¥ï¼šæœ¬åœ°æ‰“åŒ…

åœ¨ Windows æœ¬åœ°è¿è¡Œï¼š

```bash
# åŒå‡»è¿è¡Œ
baota-deploy.bat

# æˆ–å‘½ä»¤è¡Œè¿è¡Œ
npm install
npm run build
npm run package
```

æ‰“åŒ…å®Œæˆåï¼Œå‹ç¼© `package-release` æ–‡ä»¶å¤¹ã€‚

---

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨

1. **ç™»å½•å®å¡”é¢æ¿**
2. **åˆ›å»ºç›®å½•**ï¼š`/www/wwwroot/photo-album`
3. **ä¸Šä¼ å‹ç¼©åŒ…**å¹¶è§£å‹
4. **åˆ›å»ºæ•°æ®åº“**ï¼š
   - æ•°æ®åº“åï¼š`photo_album_db`
   - ç”¨æˆ·åï¼š`photo_user`
   - å¯†ç ï¼šè®¾ç½®å¼ºå¯†ç 

---

### ç¬¬ä¸‰æ­¥ï¼šæœåŠ¡å™¨éƒ¨ç½²

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/photo-album

# è¿è¡Œè‡ªåŠ¨éƒ¨ç½²è„šæœ¬
bash baota-deploy.sh

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
npm install --production
npm run init-db
pm2 start server/app.js --name photo-album
pm2 save
```

---

## ğŸ”§ é…ç½® Nginx

åœ¨å®å¡”é¢æ¿ â†’ ç½‘ç«™ â†’ é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    root /www/wwwroot/photo-album/dist;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    location /api {
        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /uploads {
        alias /www/wwwroot/photo-album/server/uploads;
    }
    
    client_max_body_size 20M;
}
```

é‡è½½ Nginxï¼š`nginx -s reload`

---

## âœ… éªŒè¯éƒ¨ç½²

1. **æ£€æŸ¥æœåŠ¡**ï¼š`pm2 status`
2. **è®¿é—®ç½‘ç«™**ï¼š`http://your-domain.com`
3. **æµ‹è¯•ç™»å½•**ï¼š
   - å‰å°å¯†ç ï¼š`user123`
   - åå°å¯†ç ï¼š`admin123`

---

## ğŸ”’ å®‰å…¨è®¾ç½®ï¼ˆé‡è¦ï¼ï¼‰

éƒ¨ç½²å®Œæˆåç«‹å³æ‰§è¡Œï¼š

1. **ä¿®æ”¹å¯†ç **ï¼šç™»å½•åå° â†’ å¯†ç ç®¡ç†
2. **ä¿®æ”¹ .env**ï¼š
   ```bash
   nano /www/wwwroot/photo-album/.env
   ```
   ä¿®æ”¹ï¼š
   - `JWT_SECRET` - æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²
   - `SUPER_PASSWORD` - æ”¹ä¸ºå¼ºå¯†ç 
   - `DB_PASSWORD` - ç¡®è®¤æ•°æ®åº“å¯†ç æ­£ç¡®

3. **é…ç½® SSL**ï¼šå®å¡”é¢æ¿ â†’ SSL â†’ Let's Encrypt
4. **è®¾ç½®å¤‡ä»½**ï¼šå®å¡”é¢æ¿ â†’ è®¡åˆ’ä»»åŠ¡

---

## ğŸ“‹ ç¯å¢ƒå˜é‡é…ç½®

ç¼–è¾‘ `/www/wwwroot/photo-album/.env`ï¼š

```env
NODE_ENV=production
PORT=3000

# æ•°æ®åº“é…ç½®ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
DB_HOST=localhost
DB_PORT=5432
DB_NAME=photo_album_db
DB_USER=photo_user
DB_PASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 

# JWT å¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=éšæœºç”Ÿæˆçš„é•¿å­—ç¬¦ä¸²
JWT_EXPIRE=7d

# æ–‡ä»¶ä¸Šä¼ 
UPLOAD_PATH=./server/uploads
MAX_FILE_SIZE=10485760

# è¶…çº§å¯†ç ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
SUPER_PASSWORD=ä½ çš„è¶…çº§å¯†ç 
```

ç”Ÿæˆéšæœº JWT_SECRETï¼š
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

---

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### PM2 ç®¡ç†
```bash
pm2 status              # æŸ¥çœ‹çŠ¶æ€
pm2 logs photo-album    # æŸ¥çœ‹æ—¥å¿—
pm2 restart photo-album # é‡å¯
pm2 stop photo-album    # åœæ­¢
```

### æ•°æ®åº“ç®¡ç†
```bash
npm run init-db         # åˆå§‹åŒ–æ•°æ®åº“
npm run show-passwords  # æŸ¥çœ‹å¯†ç 
npm run reset-password  # é‡ç½®å¯†ç 
```

### Nginx ç®¡ç†
```bash
nginx -t                # æµ‹è¯•é…ç½®
nginx -s reload         # é‡è½½é…ç½®
systemctl status nginx  # æŸ¥çœ‹çŠ¶æ€
```

---

## â“ å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æµ‹è¯•è¿æ¥
npm run test-db

# æ£€æŸ¥é…ç½®
cat .env | grep DB_

# æ£€æŸ¥æ•°æ®åº“æœåŠ¡
systemctl status postgresql
```

### 2. åº”ç”¨å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs photo-album --err

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
node server/app.js
```

### 3. é¡µé¢ 404
- æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ root è·¯å¾„
- ç¡®è®¤ dist ç›®å½•å­˜åœ¨
- é‡è½½ Nginx

### 4. æ–‡ä»¶ä¸Šä¼ å¤±è´¥
```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -la server/uploads
chmod 755 server/uploads

# æ£€æŸ¥ Nginx ä¸Šä¼ é™åˆ¶
grep client_max_body_size /www/server/nginx/conf/nginx.conf
```

---

## ğŸ“Š éƒ¨ç½²æ¶æ„

```
ç”¨æˆ·æµè§ˆå™¨
    â†“
Nginx (80/443)
    â†“
    â”œâ”€â†’ /          â†’ å‰ç«¯é™æ€æ–‡ä»¶ (dist/)
    â”œâ”€â†’ /api       â†’ Node.js åç«¯ (3000)
    â””â”€â†’ /uploads   â†’ ä¸Šä¼ æ–‡ä»¶ç›®å½•
         â†“
    Node.js + Express
         â†“
    PostgreSQL æ•°æ®åº“
```

---

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
/www/wwwroot/photo-album/
â”œâ”€â”€ dist/                 # å‰ç«¯æ„å»ºæ–‡ä»¶
â”œâ”€â”€ server/              # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ app.js          # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config/         # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ routes/         # è·¯ç”±
â”‚   â”œâ”€â”€ scripts/        # å·¥å…·è„šæœ¬
â”‚   â””â”€â”€ uploads/        # ä¸Šä¼ æ–‡ä»¶
â”œâ”€â”€ .env                # ç¯å¢ƒå˜é‡ï¼ˆå¿…é¡»é…ç½®ï¼‰
â”œâ”€â”€ package.json        # ä¾èµ–é…ç½®
â””â”€â”€ ecosystem.config.cjs # PM2 é…ç½®
```

---

## ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

ä½¿ç”¨ **BAOTA_CHECKLIST.md** é€é¡¹æ£€æŸ¥ï¼š

- [ ] æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡
- [ ] æ•°æ®åº“åˆ›å»ºé…ç½®
- [ ] æ–‡ä»¶ä¸Šä¼ è§£å‹
- [ ] ç¯å¢ƒå˜é‡é…ç½®
- [ ] ä¾èµ–å®‰è£…
- [ ] æ•°æ®åº“åˆå§‹åŒ–
- [ ] åº”ç”¨å¯åŠ¨
- [ ] Nginx é…ç½®
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] å®‰å…¨åŠ å›º

---

## ğŸ“ è·å–å¸®åŠ©

1. **æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£**ï¼š`DEPLOY_BAOTA.md`
2. **æŸ¥çœ‹æ—¥å¿—**ï¼š`pm2 logs photo-album`
3. **æµ‹è¯•æ•°æ®åº“**ï¼š`npm run test-db`
4. **æŸ¥çœ‹å¯†ç **ï¼š`npm run show-passwords`

---

## ğŸ‰ éƒ¨ç½²æˆåŠŸï¼

è®¿é—®ä½ çš„ç½‘ç«™ï¼š
- å‰å°ï¼š`https://your-domain.com`
- åå°ï¼š`https://your-domain.com/admin`

è®°å¾—ï¼š
1. âœ… ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 
2. âœ… é…ç½® SSL è¯ä¹¦
3. âœ… è®¾ç½®å®šæœŸå¤‡ä»½
4. âœ… å¼€å§‹ä½¿ç”¨ï¼

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€
